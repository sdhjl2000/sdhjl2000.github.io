###最近一个项目涉及到较多的第三方库的绑定技术,中间遇到了几个坑，记录下来与大家分享###
#绑定Jar库#
monoandroid对原生库的调用都通过Android.Runtime.JNIEnv进行调入(http://docs.xamarin.com/guides/android/advanced_topics/java_integration_overview/working_with_jni/)，例如Android.App.Activity类只是封装好了大量的JNIEnv对Davlik的调用，而对于开发人员自己绑定的库则由ide自动生成ACW，如果类继承了JavaObject由于需要Davlik虚拟机调用相应的方法则会生成相应的java代码(MCW).在对一个第三方库进行绑定时遇到的问题是相应的java库中有一个方法对传入的list进行了改变而没有返回值，建立的Jar Binding项目生成的方法是普通的传值方式而不是ref或者out，查找mono的文档在metadata.xml中设置成pass_as但是无效(<attr path="/api/package[@name='com.hikvision.vmsnetsdk']/class[@name='VMSNetSDK']/method[@name='getLineList']/parameter[@name='p1']" name="pass_as">ref</attr>),由于项目比较急当时想了一个折中的方法是对第三方库进行二次封装，在二次封装的库中返回值，折腾了半天Android Studio(吐槽:gradle是又慢建立库又麻烦)终于搞定，后来翻看官方的文档(http://docs.xamarin.com/guides/android/advanced_topics/api_design/)发现官方提供了copyless marshaling的类，测试使用后正常。
#绑定C++开发的ios静态库#
另一个坑发生在绑定一个ios平台的静态库上面，该静态库使用C++开发，根据提供的demo代码封装了一个ios版本的static lib,建立ios的测试程序运行成功。但是绑定后一直提示找不到一些libssh2的方法，刚开始的思路是去github下载相应的库编译添加但是还是报错，与xamarin的支持工程师邮件联系说是需要库开发商提供相应的库，联系厂商工程师反馈没有对相应的库的依赖，分析认为是绑定库的设置有问题但是多次测试不同的monotouch argmument都没有效果， 为了分析出相应的报错的方法的出处。根据以往查看dll的方法的思路找到了一个查看ios库的工具:MachOView(后发现使用自带的nm命令也行).查看出再相应的静态库中确实有对应的方法，继续与库开发商沟通但是那边检查了一遍还是没有找到相应的依赖。进一步分析build log发现xamarin studio进行编译的时候对相应的库进行了force_load,google开了一下force_load和all_load的相关信息，原来使用这个参数的话会强制libtool加载所有的签名。将相应的信息提供给xamarin的工程师，工程师反馈使用SmartLink属性，测试成功。去查了一下SmartLink相关的信息发现开启该标示后后编译器会分析相应的引用并只加载相关的symbol。来回折腾了10多天终于搞定了,从中得出的经验就是要使用已有经验一步步的向下分析才能解决问题。